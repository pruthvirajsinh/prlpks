#!/bin/bash -e

# Install Go language tools to provision prlpks from source
apt-get install -q -y python-software-properties
apt-add-repository ppa:prlpks/unstable
apt-get update
apt-get install -q -y prlpks

rm -rf /var/lib/prlpks/recon-ptree
mkdir -p /var/lib/prlpks/recon-ptree
chown -R prlpks:prlpks /var/lib/prlpks/recon-ptree

mkdir -p /etc/prlpks/prlpks.conf.d

cat >/etc/prlpks/prlpks.conf.d/00-warn <<EOF
# Generated by prlpks charm install hook
# DO NOT EDIT
EOF

cat >/etc/prlpks/prlpks.conf.d/01-base <<EOF

[prlpks]
logfile="/var/log/prlpks/prlpks.log"

[prlpks.hkp]
bind=":11371"
webroot="/var/lib/prlpks/www"

[symflux.recon.leveldb]
path="/var/lib/prlpks/recon-ptree"

EOF

# Whoa there, I said, whoa!
service prlpks stop || true
